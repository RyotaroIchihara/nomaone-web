---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import FlowStep from '../../components/FlowStep.astro';
import ContactBlock from '../../components/ContactBlock.astro';
import { getSiteData } from '../../data/load';
import { formatPhoneForTel } from '../../utils/format';
import flowHeroImage from '../../assets/images/hero/flow-hero.jpg';

const data = await getSiteData();
const { flow } = data;
const { source, steps, authority_contact } = flow;

const pageTitle = 'サービス利用の流れ';
const pageDescription = '障害福祉サービスの利用開始までの手続の流れをご説明します。ご不明な点はお気軽にご相談ください。';
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <Hero
    title={pageTitle}
    description={pageDescription}
    image={flowHeroImage}
    imageAlt="支援の計画と実行の様子"
    size="sm"
  />

  <div class="section">
    <div class="container">
      <div class="max-w-3xl mx-auto">
        <!-- 出典 -->
        <div class="text-center mb-12">
          <p class="text-gray-600">
            このページは
            <a
              href={source.url}
              class="text-primary-600 hover:text-primary-500"
              target="_blank"
              rel="noopener noreferrer"
            >
              {source.title}
              <svg
                class="w-4 h-4 ml-1 inline-block"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M7 17l9.2-9.2M17 17V7H7"/>
              </svg>
            </a>
            を元に作成しています。
          </p>
        </div>

        <!-- フローステップ -->
        <div class="card">
          {steps.map(step => (
            <FlowStep
              no={step.no}
              title={step.title}
              detail={step.detail}
            />
          ))}
        </div>

        <!-- 所管連絡先 -->
        <div class="mt-12 text-center">
          <p class="text-gray-700 mb-2">{authority_contact.department}</p>
          <a
            href={formatPhoneForTel(authority_contact.tel)}
            class="inline-flex items-center text-primary-600 hover:text-primary-500"
          >
            <svg
              class="w-5 h-5 mr-2"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
            {authority_contact.tel}
          </a>
        </div>
      </div>
    </div>
  </div>

  <ContactBlock />
</BaseLayout>
